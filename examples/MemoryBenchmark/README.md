# Memory Benchmark

The `MemoryBenchmark.ino` was compiled with each `FEATURE_*` and the flash
memory and static RAM sizes were recorded. The `FEATURE_BASELINE` selection is
the baseline, and its memory usage  numbers are subtracted from the subsequent
`FEATURE_*` memory usage.

**NOTE**: This file was auto-generated using `make README.md`. DO NOT EDIT.

**Version**: AceTime v1.4.1

## How to Regenerate

To regenerate this README.md:

```
$ make clean_benchmarks
$ make benchmarks
$ make README.md
```

The `make benchmarks` target uses `collect.sh` script which calls `auniter.sh`
(https://github.com/bxparks/AUniter) to invoke the Arduino IDE programmatically.
It produces a `*.txt` file with the flash and ram usage information (e.g.
`nano.txt`). It now takes about 16 minutes to generate the `*.txt` files on my
quad-core Intel Core i7-3840QM CPU @ 2.80GHz laptop.

The `make README.md` command calls the `generated_readme.py` Python script which
generates this `README.md` file. The ASCII tables below are generated by the
`generate_table.awk` script, which takes each `*.txt` file and converts it to an
ASCII table.

## Library Size Changes

In v1.3, the `BasicZoneManager` and `ExtendedZoneManager` classes were unified
under a new parent interface `ZoneManager`. This seems to have caused the flash
size to increase by around 1200 bytes on the AVR processors (Nano, Pro Micro),
about 500 bytes on a SAMD, about 800 bytes on a ESP8266, 100 bytes on a ESP32,
and 1400 bytes on a Teensy 3.2. The 8-bit processors suffer the most
flash size increase proportional to their limited 32kB limit.

Adding the `ZoneManager` interface simplifies a lot of the complexity with
saving and restoring time zones using the `TimeZoneData` object, and I think it
is worth the extra cost of flash size. The mitigating factor is that
applications targetted towards 8-bit processors will normally have fixed number
of timezones at compile time, so they can avoid using a `ZoneManager`, and avoid
this penalty in flash size.

In v1.4.1+, we removed the `ZoneInfo::transitionBufSize` field from the
`ZoneInfo` struct, which saves 1 byte on 8-bit processors (none on 32-bit
processors due to 4-byte alignment). We save 266 bytes for `BasicZoneManager`
and 386 bytes for `ExtendedZoneManager` when all the zones are loaded into the
zone registry.

Also for v1.4.1+, incorporating zoneName compression causes flash/ram usage to
increase by ~250/120 bytes when using only 1-2 zones, but *decreases* flash
consumption by 1200-2400 bytes when all the zones are loaded into the
`ZoneManager`.

## Arduino Nano

* Arduino IDE 1.8.13
* Arduino AVR Boards 1.8.3

```
+--------------------------------------------------------------+
| Functionality                   |  flash/  ram |       delta |
|---------------------------------+--------------+-------------|
| Baseline                        |    448/   10 |     0/    0 |
|---------------------------------+--------------+-------------|
| LocalDateTime                   |   1648/  123 |  1200/  113 |
| ZonedDateTime                   |   2440/  123 |  1992/  113 |
| Manual ZoneManager              |   2684/  123 |  2236/  113 |
| Basic TimeZone (1 zone)         |   7168/  309 |  6720/  299 |
| Basic TimeZone (2 zones)        |   7736/  313 |  7288/  303 |
| Basic ZoneManager (1 zone)      |   8816/  335 |  8368/  325 |
| Basic ZoneManager (all)         |  21800/  711 | 21352/  701 |
| Extended TimeZone (1 zone)      |   9982/  343 |  9534/  333 |
| Extended TimeZone (2 zones)     |  10450/  347 | 10002/  337 |
| Extended ZoneManager (1 zone)   |  11790/  369 | 11342/  359 |
| Extended ZoneManager (all)      |  33844/  853 | 33396/  843 |
|---------------------------------+--------------+-------------|
| SystemClock                     |   5662/  282 |  5214/  272 |
| SystemClock+Basic TimeZone      |  10248/  456 |  9800/  446 |
| SystemClock+Extended TimeZone   |  13288/  490 | 12840/  480 |
+--------------------------------------------------------------+

```

## Sparkfun Pro Micro

* Arduino IDE 1.8.13
* SparkFun AVR Boards 1.1.13

```
+--------------------------------------------------------------+
| Functionality                   |  flash/  ram |       delta |
|---------------------------------+--------------+-------------|
| Baseline                        |   3464/  150 |     0/    0 |
|---------------------------------+--------------+-------------|
| LocalDateTime                   |   4772/  263 |  1308/  113 |
| ZonedDateTime                   |   5564/  263 |  2100/  113 |
| Manual ZoneManager              |   5808/  263 |  2344/  113 |
| Basic TimeZone (1 zone)         |  10268/  447 |  6804/  297 |
| Basic TimeZone (2 zones)        |  10838/  453 |  7374/  303 |
| Basic ZoneManager (1 zone)      |  11916/  473 |  8452/  323 |
| Basic ZoneManager (all)         |  24902/  851 | 21438/  701 |
| Extended TimeZone (1 zone)      |  13082/  481 |  9618/  331 |
| Extended TimeZone (2 zones)     |  13552/  487 | 10088/  337 |
| Extended ZoneManager (1 zone)   |  14890/  507 | 11426/  357 |
| Extended ZoneManager (all)      |  36944/  991 | 33480/  841 |
|---------------------------------+--------------+-------------|
| SystemClock                     |   8646/  422 |  5182/  272 |
| SystemClock+Basic TimeZone      |  13230/  594 |  9766/  444 |
| SystemClock+Extended TimeZone   |  16270/  628 | 12806/  478 |
+--------------------------------------------------------------+

```

## SAMD21 M0 Mini

* Arduino IDE 1.8.13
* Sparkfun SAMD Boards 1.8.1

```
+--------------------------------------------------------------+
| Functionality                   |  flash/  ram |       delta |
|---------------------------------+--------------+-------------|
| Baseline                        |  10064/    0 |     0/    0 |
|---------------------------------+--------------+-------------|
| LocalDateTime                   |  10920/    0 |   856/    0 |
| ZonedDateTime                   |  11160/    0 |  1096/    0 |
| Manual ZoneManager              |  11184/    0 |  1120/    0 |
| Basic TimeZone (1 zone)         |  15300/    0 |  5236/    0 |
| Basic TimeZone (2 zones)        |  15684/    0 |  5620/    0 |
| Basic ZoneManager (1 zone)      |  16332/    0 |  6268/    0 |
| Basic ZoneManager (all)         |  33844/    0 | 23780/    0 |
| Extended TimeZone (1 zone)      |  17108/    0 |  7044/    0 |
| Extended TimeZone (2 zones)     |  17532/    0 |  7468/    0 |
| Extended ZoneManager (1 zone)   |  18140/    0 |  8076/    0 |
| Extended ZoneManager (all)      |  48164/    0 | 38100/    0 |
|---------------------------------+--------------+-------------|
| SystemClock                     |  13264/    0 |  3200/    0 |
| SystemClock+Basic TimeZone      |  16940/    0 |  6876/    0 |
| SystemClock+Extended TimeZone   |  18932/    0 |  8868/    0 |
+--------------------------------------------------------------+

```

(SAMD compiler does not produce RAM usage numbers.)

## ESP8266

* Arduino IDE 1.8.13
* ESP8266 Boards 2.7.4

```
+--------------------------------------------------------------+
| Functionality                   |  flash/  ram |       delta |
|---------------------------------+--------------+-------------|
| Baseline                        | 256700/26776 |     0/    0 |
|---------------------------------+--------------+-------------|
| LocalDateTime                   | 258820/27264 |  2120/  488 |
| ZonedDateTime                   | 259492/27264 |  2792/  488 |
| Manual ZoneManager              | 259540/27264 |  2840/  488 |
| Basic TimeZone (1 zone)         | 265228/27824 |  8528/ 1048 |
| Basic TimeZone (2 zones)        | 265452/27824 |  8752/ 1048 |
| Basic ZoneManager (1 zone)      | 266348/27824 |  9648/ 1048 |
| Basic ZoneManager (all)         | 283980/27824 | 27280/ 1048 |
| Extended TimeZone (1 zone)      | 267292/27968 | 10592/ 1192 |
| Extended TimeZone (2 zones)     | 267580/27968 | 10880/ 1192 |
| Extended ZoneManager (1 zone)   | 268412/27968 | 11712/ 1192 |
| Extended ZoneManager (all)      | 298608/27980 | 41908/ 1204 |
|---------------------------------+--------------+-------------|
| SystemClock                     | 262268/27276 |  5568/  500 |
| SystemClock+Basic TimeZone      | 267624/27824 | 10924/ 1048 |
| SystemClock+Extended TimeZone   | 269944/27968 | 13244/ 1192 |
+--------------------------------------------------------------+

```

## ESP32

* Arduino IDE 1.8.13
* ESP32 Boards 1.0.4

```
+--------------------------------------------------------------+
| Functionality                   |  flash/  ram |       delta |
|---------------------------------+--------------+-------------|
| Baseline                        | 206435/14564 |     0/    0 |
|---------------------------------+--------------+-------------|
| LocalDateTime                   | 218425/16116 | 11990/ 1552 |
| ZonedDateTime                   | 219229/16116 | 12794/ 1552 |
| Manual ZoneManager              | 219261/16116 | 12826/ 1552 |
| Basic TimeZone (1 zone)         | 223225/16116 | 16790/ 1552 |
| Basic TimeZone (2 zones)        | 223469/16116 | 17034/ 1552 |
| Basic ZoneManager (1 zone)      | 224085/16116 | 17650/ 1552 |
| Basic ZoneManager (all)         | 241797/16116 | 35362/ 1552 |
| Extended TimeZone (1 zone)      | 225153/16116 | 18718/ 1552 |
| Extended TimeZone (2 zones)     | 225421/16116 | 18986/ 1552 |
| Extended ZoneManager (1 zone)   | 226109/16116 | 19674/ 1552 |
| Extended ZoneManager (all)      | 256393/16116 | 49958/ 1552 |
|---------------------------------+--------------+-------------|
| SystemClock                     | 226013/16220 | 19578/ 1656 |
| SystemClock+Basic TimeZone      | 229909/16220 | 23474/ 1656 |
| SystemClock+Extended TimeZone   | 231901/16220 | 25466/ 1656 |
+--------------------------------------------------------------+

```

RAM usage remains constant as more objects are created, which indicates that an
initial pool of a certain minimum size is created regardless of the actual RAM
usage by objects.

## Teensy 3.2

* Arduino IDE 1.8.13
* Teensyduino 1.53

```
+--------------------------------------------------------------+
| Functionality                   |  flash/  ram |       delta |
|---------------------------------+--------------+-------------|
| Baseline                        |   7624/ 3048 |     0/    0 |
|---------------------------------+--------------+-------------|
| LocalDateTime                   |  13268/ 4812 |  5644/ 1764 |
| ZonedDateTime                   |  13268/ 4812 |  5644/ 1764 |
| Manual ZoneManager              |  13268/ 4812 |  5644/ 1764 |
| Basic TimeZone (1 zone)         |  22264/ 4812 | 14640/ 1764 |
| Basic TimeZone (2 zones)        |  22992/ 4812 | 15368/ 1764 |
| Basic ZoneManager (1 zone)      |  23536/ 4812 | 15912/ 1764 |
| Basic ZoneManager (all)         |  41280/ 4812 | 33656/ 1764 |
| Extended TimeZone (1 zone)      |  24564/ 4812 | 16940/ 1764 |
| Extended TimeZone (2 zones)     |  25228/ 4812 | 17604/ 1764 |
| Extended ZoneManager (1 zone)   |  25836/ 4812 | 18212/ 1764 |
| Extended ZoneManager (all)      |  56116/ 4812 | 48492/ 1764 |
|---------------------------------+--------------+-------------|
| SystemClock                     |  16192/ 4812 |  8568/ 1764 |
| SystemClock+Basic TimeZone      |  25372/ 4812 | 17748/ 1764 |
| SystemClock+Extended TimeZone   |  27672/ 4812 | 20048/ 1764 |
+--------------------------------------------------------------+

```

