# Memory Benchmark

The `MemoryBenchmark.ino` was compiled with each `FEATURE_*` and the flash
memory and static RAM sizes were recorded. The `FEATURE_BASELINE` selection is
the baseline, and its memory usage  numbers are subtracted from the subsequent
`FEATURE_*` memory usage.

**NOTE**: This file was auto-generated using `make README.md`. DO NOT EDIT.

**Version**: AceTime v1.4.1

## How to Regenerate

To regenerate this README.md:

```
$ make clean_benchmarks
$ make benchmarks
$ make README.md
```

The `make benchmarks` target uses `collect.sh` script which calls `auniter.sh`
(https://github.com/bxparks/AUniter) to invoke the Arduino IDE programmatically.
It produces a `*.txt` file with the flash and ram usage information (e.g.
`nano.txt`). It now takes about 16 minutes to generate the `*.txt` files on my
quad-core Intel Core i7-3840QM CPU @ 2.80GHz laptop.

The `make README.md` command calls the `generated_readme.py` Python script which
generates this `README.md` file. The ASCII tables below are generated by the
`generate_table.awk` script, which takes each `*.txt` file and converts it to an
ASCII table.

## Library Size Changes

In v1.3, the `BasicZoneManager` and `ExtendedZoneManager` classes were unified
under a new parent interface `ZoneManager`. This seems to have caused the flash
size to increase by around 1200 bytes on the AVR processors (Nano, Pro Micro),
about 500 bytes on a SAMD, about 800 bytes on a ESP8266, 100 bytes on a ESP32,
and 1400 bytes on a Teensy 3.2. The 8-bit processors suffer the most
flash size increase proportional to their limited 32kB limit.

Adding the `ZoneManager` interface simplifies a lot of the complexity with
saving and restoring time zones using the `TimeZoneData` object, and I think it
is worth the extra cost of flash size. The mitigating factor is that
applications targetted towards 8-bit processors will normally have fixed number
of timezones at compile time, so they can avoid using a `ZoneManager`, and avoid
this penalty in flash size.

## Arduino Nano

* Arduino IDE 1.8.13
* Arduino AVR Boards 1.8.3

```
+--------------------------------------------------------------+
| Functionality                   |  flash/  ram |       delta |
|---------------------------------+--------------+-------------|
| Baseline                        |    448/   10 |     0/    0 |
|---------------------------------+--------------+-------------|
| LocalDateTime                   |   1648/  123 |  1200/  113 |
| ZonedDateTime                   |   2440/  123 |  1992/  113 |
| Manual ZoneManager              |   2684/  123 |  2236/  113 |
| Basic TimeZone (1 zone)         |   6910/  187 |  6462/  177 |
| Basic TimeZone (2 zones)        |   7488/  193 |  7040/  183 |
| Basic ZoneManager (1 zone)      |   8428/  213 |  7980/  203 |
| Basic ZoneManager (all)         |  23206/  591 | 22758/  581 |
| Extended TimeZone (1 zone)      |   9690/  187 |  9242/  177 |
| Extended TimeZone (2 zones)     |  10166/  193 |  9718/  183 |
| Extended ZoneManager (1 zone)   |  11368/  213 | 10920/  203 |
| Extended ZoneManager (all)      |  36232/  697 | 35784/  687 |
|---------------------------------+--------------+-------------|
| SystemClock                     |   5662/  282 |  5214/  272 |
| SystemClock+Basic TimeZone      |   9990/  334 |  9542/  324 |
| SystemClock+Extended TimeZone   |  12996/  334 | 12548/  324 |
+--------------------------------------------------------------+

```

## Sparkfun Pro Micro

* Arduino IDE 1.8.13
* SparkFun AVR Boards 1.1.13

```
+--------------------------------------------------------------+
| Functionality                   |  flash/  ram |       delta |
|---------------------------------+--------------+-------------|
| Baseline                        |   3464/  150 |     0/    0 |
|---------------------------------+--------------+-------------|
| LocalDateTime                   |   4772/  263 |  1308/  113 |
| ZonedDateTime                   |   5564/  263 |  2100/  113 |
| Manual ZoneManager              |   5808/  263 |  2344/  113 |
| Basic TimeZone (1 zone)         |  10012/  327 |  6548/  177 |
| Basic TimeZone (2 zones)        |  10588/  331 |  7124/  181 |
| Basic ZoneManager (1 zone)      |  11530/  353 |  8066/  203 |
| Basic ZoneManager (all)         |  26306/  729 | 22842/  579 |
| Extended TimeZone (1 zone)      |  12792/  327 |  9328/  177 |
| Extended TimeZone (2 zones)     |  13266/  331 |  9802/  181 |
| Extended ZoneManager (1 zone)   |  14470/  353 | 11006/  203 |
| Extended ZoneManager (all)      |  39334/  837 | 35870/  687 |
|---------------------------------+--------------+-------------|
| SystemClock                     |   8646/  422 |  5182/  272 |
| SystemClock+Basic TimeZone      |  12974/  474 |  9510/  324 |
| SystemClock+Extended TimeZone   |  15980/  474 | 12516/  324 |
+--------------------------------------------------------------+

```

## SAMD21 M0 Mini

* Arduino IDE 1.8.13
* Sparkfun SAMD Boards 1.8.1

```
+--------------------------------------------------------------+
| Functionality                   |  flash/  ram |       delta |
|---------------------------------+--------------+-------------|
| Baseline                        |  10064/    0 |     0/    0 |
|---------------------------------+--------------+-------------|
| LocalDateTime                   |  10920/    0 |   856/    0 |
| ZonedDateTime                   |  11160/    0 |  1096/    0 |
| Manual ZoneManager              |  11184/    0 |  1120/    0 |
| Basic TimeZone (1 zone)         |  15044/    0 |  4980/    0 |
| Basic TimeZone (2 zones)        |  15436/    0 |  5372/    0 |
| Basic ZoneManager (1 zone)      |  15972/    0 |  5908/    0 |
| Basic ZoneManager (all)         |  35004/    0 | 24940/    0 |
| Extended TimeZone (1 zone)      |  16820/    0 |  6756/    0 |
| Extended TimeZone (2 zones)     |  17244/    0 |  7180/    0 |
| Extended ZoneManager (1 zone)   |  17748/    0 |  7684/    0 |
| Extended ZoneManager (all)      |  50196/    0 | 40132/    0 |
|---------------------------------+--------------+-------------|
| SystemClock                     |  13264/    0 |  3200/    0 |
| SystemClock+Basic TimeZone      |  16684/    0 |  6620/    0 |
| SystemClock+Extended TimeZone   |  18644/    0 |  8580/    0 |
+--------------------------------------------------------------+

```

(SAMD compiler does not produce RAM usage numbers.)

## ESP8266

* Arduino IDE 1.8.13
* ESP8266 Boards 2.7.4

```
+--------------------------------------------------------------+
| Functionality                   |  flash/  ram |       delta |
|---------------------------------+--------------+-------------|
| Baseline                        | 256700/26776 |     0/    0 |
|---------------------------------+--------------+-------------|
| LocalDateTime                   | 258820/27264 |  2120/  488 |
| ZonedDateTime                   | 259492/27264 |  2792/  488 |
| Manual ZoneManager              | 259540/27264 |  2840/  488 |
| Basic TimeZone (1 zone)         | 264792/27676 |  8092/  900 |
| Basic TimeZone (2 zones)        | 265016/27676 |  8316/  900 |
| Basic ZoneManager (1 zone)      | 265768/27676 |  9068/  900 |
| Basic ZoneManager (all)         | 284952/27676 | 28252/  900 |
| Extended TimeZone (1 zone)      | 266800/27788 | 10100/ 1012 |
| Extended TimeZone (2 zones)     | 267120/27788 | 10420/ 1012 |
| Extended ZoneManager (1 zone)   | 267792/27788 | 11092/ 1012 |
| Extended ZoneManager (all)      | 300468/27792 | 43768/ 1016 |
|---------------------------------+--------------+-------------|
| SystemClock                     | 262268/27276 |  5568/  500 |
| SystemClock+Basic TimeZone      | 267188/27676 | 10488/  900 |
| SystemClock+Extended TimeZone   | 269452/27788 | 12752/ 1012 |
+--------------------------------------------------------------+

```

## ESP32

* Arduino IDE 1.8.13
* ESP32 Boards 1.0.4

```
+--------------------------------------------------------------+
| Functionality                   |  flash/  ram |       delta |
|---------------------------------+--------------+-------------|
| Baseline                        | 206435/14564 |     0/    0 |
|---------------------------------+--------------+-------------|
| LocalDateTime                   | 218233/16100 | 11798/ 1536 |
| ZonedDateTime                   | 219037/16100 | 12602/ 1536 |
| Manual ZoneManager              | 219069/16100 | 12634/ 1536 |
| Basic TimeZone (1 zone)         | 222729/16100 | 16294/ 1536 |
| Basic TimeZone (2 zones)        | 222981/16100 | 16546/ 1536 |
| Basic ZoneManager (1 zone)      | 223461/16100 | 17026/ 1536 |
| Basic ZoneManager (all)         | 242749/16100 | 36314/ 1536 |
| Extended TimeZone (1 zone)      | 224617/16100 | 18182/ 1536 |
| Extended TimeZone (2 zones)     | 224893/16100 | 18458/ 1536 |
| Extended ZoneManager (1 zone)   | 225445/16100 | 19010/ 1536 |
| Extended ZoneManager (all)      | 258213/16100 | 51778/ 1536 |
|---------------------------------+--------------+-------------|
| SystemClock                     | 225821/16204 | 19386/ 1640 |
| SystemClock+Basic TimeZone      | 229413/16204 | 22978/ 1640 |
| SystemClock+Extended TimeZone   | 231365/16204 | 24930/ 1640 |
+--------------------------------------------------------------+

```

RAM usage remains constant as more objects are created, which indicates that an
initial pool of a certain minimum size is created regardless of the actual RAM
usage by objects.

## Teensy 3.2

* Arduino IDE 1.8.13
* Teensyduino 1.53

```
+--------------------------------------------------------------+
| Functionality                   |  flash/  ram |       delta |
|---------------------------------+--------------+-------------|
| Baseline                        |   7624/ 3048 |     0/    0 |
|---------------------------------+--------------+-------------|
| LocalDateTime                   |  13268/ 4812 |  5644/ 1764 |
| ZonedDateTime                   |  13268/ 4812 |  5644/ 1764 |
| Manual ZoneManager              |  13268/ 4812 |  5644/ 1764 |
| Basic TimeZone (1 zone)         |  22012/ 4812 | 14388/ 1764 |
| Basic TimeZone (2 zones)        |  22684/ 4812 | 15060/ 1764 |
| Basic ZoneManager (1 zone)      |  23860/ 4812 | 16236/ 1764 |
| Basic ZoneManager (all)         |  43116/ 4812 | 35492/ 1764 |
| Extended TimeZone (1 zone)      |  24204/ 4812 | 16580/ 1764 |
| Extended TimeZone (2 zones)     |  24940/ 4812 | 17316/ 1764 |
| Extended ZoneManager (1 zone)   |  26052/ 4812 | 18428/ 1764 |
| Extended ZoneManager (all)      |  58880/ 4812 | 51256/ 1764 |
|---------------------------------+--------------+-------------|
| SystemClock                     |  16192/ 4812 |  8568/ 1764 |
| SystemClock+Basic TimeZone      |  25120/ 4812 | 17496/ 1764 |
| SystemClock+Extended TimeZone   |  27312/ 4812 | 19688/ 1764 |
+--------------------------------------------------------------+

```

